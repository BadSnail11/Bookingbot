
# Telegram Booking Bot (Python)

Простой Telegram-бот для бронирования столов. Пользователь выбирает дату, время, кол-во гостей, имя и телефон; бот проверяет доступные столы и создаёт заявку со статусом `pending`. Администратор подтверждает/отменяет заявку — и пользователь получает уведомление. Для вопросов/отмены бот отдаёт контакты заведения.

## Новое в этой версии
- Добавлены **правила приёма брони по дням недели** и **крайние времена записи**:
  - Пн–Чт 16:00–23:00 (**последняя запись 22:30**)
  - Пт 16:00–00:00 (**последняя запись 23:30**)
  - Сб 14:00–00:00 (**последняя запись 23:30**)
  - Вс 14:00–23:00 (**последняя запись 22:30**)
- Генерация слотов времени динамически, шагом по умолчанию **30 минут**.
- Запрет брони в день обращения (`MIN_ADVANCE_DAYS=1`). Опционально режим **"только на завтра"** (`ONLY_TOMORROW=true`).

> Примечание: ограничение «последняя запись» относится к **времени начала брони**. Закрытие заведения не ограничивается программно: при необходимости можно дополнительно проверять, чтобы `ends_at` не превышал время закрытия.

## Быстрый старт
1. Установить зависимости:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   pip install python-telegram-bot==21.4 python-dotenv
   ```
2. Настроить окружение — скопируйте `.env.example` → `.env` и заполните:
   - `TELEGRAM_BOT_TOKEN` — токен вашего бота
   - `ADMIN_IDS` — Telegram ID админов (через запятую)
   - Контакты заведения (`VENUE_*`)
   - (опц.) `MIN_ADVANCE_DAYS`, `ONLY_TOMORROW`, `TIME_SLOT_STEP_MIN`, `LOCAL_TZ`
3. Инициализировать БД:
   ```bash
   python db_init.py
   ```
4. Запустить бота:
   ```bash
   python bot.py
   ```

## Команды
- Пользователь: `/book`, `/my`, `/contacts`, `/help`
- Админ: `/pending`, `/confirm <id>`, `/cancel_res <id>`

## Настройки времени
В `bot.py` задан словарь `WEEKLY_RULES` (Python weekday: Mon=0..Sun=6):
```python
WEEKLY_RULES = {
    0: (time(16,0), time(22,30)),
    1: (time(16,0), time(22,30)),
    2: (time(16,0), time(22,30)),
    3: (time(16,0), time(22,30)),
    4: (time(16,0), time(23,30)),
    5: (time(14,0), time(23,30)),
    6: (time(14,0), time(22,30)),
}
```
Генерация слотов — каждые `TIME_SLOT_STEP_MIN` минут **включительно до последнего времени записи**.

## Идеи развития
- Учёт закрытия (не позволять, чтобы `ends_at` выходило за время закрытия).
- Предоплаты, объединение столов, план зала, мультифилиалы.
- Веб‑админка (FastAPI) + PostgreSQL.
